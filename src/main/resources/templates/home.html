<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Items - Nexio</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <th:block th:replace="~{fragments/background :: background-styles}"></th:block>
</head>
<body>
<th:block th:replace="~{fragments/background :: background-elements}"></th:block>

<div th:replace="~{fragments/navbar :: navbar(${active})}"></div>

<!-- Profile Completion Modal -->
<div id="profileCompletionModal" class="modal" th:if="${showProfilePopup}">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Complete Your Profile!</h2>
        <p>It looks like you haven't fully set up your profile yet. Please provide your first name, last name, and university to get the most out of Nexio.</p>
        <a href="/users/profile/details" class="btn btn-primary">Go to Profile</a>
    </div>
</div>

<!-- Main Content -->
<main class="main-content">
    <!-- Content Layout -->
    <div class="content-layout">
        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container-main">
                <h2>Find what you're looking for</h2>
                <p>Discover amazing items from your university community</p>
                <div class="search-bar-main">
                    <i class="fas fa-search search-icon-main"></i>
                    <input type="text" id="mainSearchInput" placeholder="Search for items, books, electronics...">
                    <button class="search-btn-main" id="mainSearchBtn">
                        <i class="fas fa-search"></i>
                        Search
                    </button>
                </div>
            </div>
        </div>
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar" id="filtersSidebar">
            <div class="filters-header">
                <h3>
                    <i class="fas fa-filter"></i>
                    Filters
                </h3>
                <button class="clear-filters" id="clearFilters">Clear All</button>
            </div>

            <!-- Category Filter -->
            <div class="filter-section">
                <h4>Category</h4>
                <div class="filter-buttons" id="categoryFilterButtons">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="TEXTBOOKS">
                        <i class="fas fa-book"></i>
                        Textbooks
                        <span class="count" th:text="${textbooksCount}">(45)</span>
                    </button>
                    <button class="filter-btn" data-filter="ELECTRONICS">
                        <i class="fas fa-laptop"></i>
                        Electronics
                        <span class="count" th:text="${electronicsCount}">(32)</span>
                    </button>
                    <button class="filter-btn" data-filter="FURNITURE">
                        <i class="fas fa-chair"></i>
                        Furniture
                        <span class="count" th:text="${furnitureCount}" >(18)</span>
                    </button>
                    <button class="filter-btn" data-filter="CLOTHING">
                        <i class="fas fa-tshirt"></i>
                        Clothing
                        <span class="count" th:text="${clothingCount}">(27)</span>
                    </button>
                    <button class="filter-btn" data-filter="SPORTS">
                        <i class="fas fa-dumbbell"></i>
                        Sports
                        <span class="count" th:text="${sportsCount}">(15)</span>
                    </button>
                    <button class="filter-btn" data-filter="ACCESSORIES">
                        <i class="fas fa-gem"></i>
                        Accessories
                        <span class="count" th:text="${accessoriesCount}">(12)</span>
                    </button>
                    <button class="filter-btn" data-filter="SERVICES">
                        <i class="fas fa-handshake"></i>
                        Services
                        <span class="count" th:text="${servicesCount}">(8)</span>
                    </button>
                </div>
            </div>

            <!-- Price Filter -->
            <div class="filter-section">
                <h4>Price Range</h4>
                <div class="price-range">
                    <div class="price-inputs">
                        <input type="number" id="minPrice" placeholder="Min" min="0">
                        <span>-</span>
                        <input type="number" id="maxPrice" placeholder="Max" min="0">
                        <span>лв</span>
                    </div>
                </div>
            </div>

            <!-- Condition Filter (matches ItemCondition enum) -->
            <div class="filter-section">
                <h4>Condition</h4>
                <div class="filter-buttons" id="conditionFilterButtons">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="NEW">
                        <i class="fas fa-star"></i>
                        New
                    </button>
                    <button class="filter-btn" data-filter="LIKE_NEW">
                        <i class="fas fa-star-half-alt"></i>
                        Like New
                    </button>
                    <button class="filter-btn" data-filter="GOOD">
                        <i class="fas fa-thumbs-up"></i>
                        Good
                    </button>
                    <button class="filter-btn" data-filter="FAIR">
                        <i class="fas fa-minus-circle"></i>
                        Fair
                    </button>
                    <button class="filter-btn" data-filter="POOR">
                        <i class="fas fa-exclamation-circle"></i>
                        Poor
                    </button>
                    <button class="filter-btn" data-filter="REFURBISHED">
                        <i class="fas fa-tools"></i>
                        Refurbished
                    </button>
                </div>
            </div>


            <!-- Location Filter -->
            <div class="filter-section">
                <h4>Location</h4>
                <select id="locationFilter" class="location-select">
                    <option value="all">All Locations</option>
                    <option value="CAMPUS">Campus</option>
                    <option value="NEARBY">Nearby</option>
                    <option value="SHIPPING">Shipping</option>
                </select>
            </div>
        </aside>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Header with sorting and view options -->
            <div class="content-header">
                <div class="results-info">
                    <h2>Browse Items</h2>
                    <p class="results-count">Showing <span id="resultsCount">157</span> items</p>
                </div>

                <div class="header-controls">
                    <div class="sort-options">
                        <label for="sortSelect">Sort by:</label>
                        <select id="sortSelect">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="popular">Most Popular</option>
                        </select>
                    </div>




                </div>
            </div>

            <!-- Active Filters -->
            <div class="active-filters" id="activeFilters">
                <!-- Active filters will be dynamically inserted here -->
            </div>

            <!-- Items Grid -->
            <div class="items-grid" id="itemsGrid">
                <!-- Items populated by Thymeleaf -->
                <div class="item-card"
                     th:each="item : ${items}"
                     th:data-category="${item.category != null ? item.category : ''}"
                     th:data-price="${item.price}"
                     th:data-condition="${item.condition != null ? item.condition : ''}"
                     th:data-id="${item.id}"
                     th:data-title="${item.name}"
                     th:data-description="${item.description}"
                     th:data-location="${item.exchangeLocation.name()}"
                     th:data-imageurl="${item.imageURL != null and !item.imageURL.isEmpty() ? item.imageURL : '/images/defaults/no_image.webp'}"
                     th:data-seller-name="${item.owner.firstName + ' ' + item.owner.lastName}"
                     th:data-seller-uni="${item.owner.university}"
                     th:data-seller-avatar="${item.owner.profilePictureURL != null ? item.owner.profilePictureURL : '/images/defaults/default_pfp.jpg'}"
                     th:data-createdat="${item.createdOn}">

                    <div class="item-image">
                        <img th:src="@{${item.imageURL != null and !item.imageURL.isEmpty() ? item.imageURL : '/images/defaults/no_image.webp'}}"
                             th:alt="${item.name ?: 'Item image'}"
                             onerror="this.src='/images/defaults/no_image.webp'">
                        <div class="item-badges">
                                <span class="condition-badge"
                                      th:classappend="${item.condition != null ? #strings.toLowerCase(item.condition.getDisplayName()).replace(' ', '-') : ''}"
                                      th:text="${item.condition.getDisplayName()}">Good</span>
                        </div>
                    </div>

                    <div class="item-content">
                        <div class="item-category" th:if="${item.category != null}">
                            <span th:text="${item.category != null ? #strings.capitalize(item.category.toString().toLowerCase()) : 'Other'}">Category</span>
                        </div>


                        <h3 class="item-title" th:text="${item.name ?: 'Untitled Item'}">Item Title</h3>

                        <p class="item-description" th:text="${item.description ?: 'No description available'}">Item description</p>

                        <div class="item-details">
                            <div class="item-price" th:text="${item.price != null ? item.price + ' лв' : 'Price not set'}">0 лв</div>
                            <div class="item-location" th:if="${item.exchangeLocation != null}">
                                <i class="fas fa-map-marker-alt"></i>
                                <span th:text="${item.exchangeLocation != null ? item.exchangeLocation.displayName : 'Location not set'}">Location</span>
                            </div>
                        </div>

                        <div class="item-actions">
                            <a th:href="@{'/items/' + ${item.id}}" class="btn btn-primary">
                                <i class="fas fa-eye"></i>
                                View Details
                            </a>
                        </div>
                        </div>
                    </div>
                </div>

            <!-- Empty state when no items (shown when filters result in no matches or when items list is empty) -->
            <div class="empty-state" id="emptyState" th:style="${items == null or items.isEmpty() ? 'display: flex;' : 'display: none;'}">
                        <div class="empty-content">
                            <i class="fas fa-box-open"></i>
                            <h3>No items found</h3>
                    <p id="emptyStateMessage">There are currently no items available.</p>
                </div>
            </div>
        </div>
    </div> <!-- End content-layout -->
</main>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

<script th:src="@{/js/home.js}"></script>
<div th:replace="~{fragments/navbar-script :: navbar-script}"></div>
</body>
</html>