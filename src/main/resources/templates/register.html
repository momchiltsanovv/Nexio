<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - nexio</title>
    <link rel="stylesheet" href="/css/home.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <th:block th:replace="fragments/background :: background-styles"></th:block>
    <style>
        .register-wrapper { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .register-container { display: grid; grid-template-columns: 1fr 1fr; max-width: 1000px; width: 100%; background: #f8f9fa; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); }
        
        /* Left side - branding */
        .register-brand { background: linear-gradient(135deg, #212346 0%, #CE3A81 100%); padding: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; position: relative; overflow: hidden; }
        .brand-content { position: relative; z-index: 1; }
        .brand-logo h2 { font-family: 'CooperBlack', serif; font-size: 40px; font-weight: normal; margin: 0 0 8px; }
        .brand-subtitle { font-size: 16px; opacity: 0.9; margin-bottom: 30px; }
        .brand-features { display: flex; flex-direction: column; gap: 20px; }
        .brand-feature { display: flex; align-items: center; gap: 12px; }
        .brand-feature i { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.2); border-radius: 50%; }
        .alert-warning {color: #dc3545; font-size: 12px; margin-top: 4px; margin-left: 8px; display: block;}
        
        /* Button visual effects */
        .btn-primary {
            transition: all 0.3s ease;
            position: relative;
            background: linear-gradient(135deg, #212346 0%, #CE3A81 100%);
            border: 2px solid transparent;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #CE3A81 0%, #212346 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .btn-primary:hover::before {
            opacity: 1;
        }
        
        .btn-primary span {
            position: relative;
            z-index: 1;
        }
        
        .btn-primary:active {
            transform: scale(0.95);
        }
        
        /* Sign in link effect */
        .form-footer a {
            background: linear-gradient(135deg, #212346 0%, #CE3A81 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .form-footer a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #212346 0%, #CE3A81 100%);
            transition: width 0.3s ease;
        }
        
        .form-footer a:hover::after {
            width: 100%;
        }
        
        
        .brand-stats { display: flex; flex-direction: column; gap: 16px; margin-top: 30px; }
        .stat-item { display: flex; align-items: center; gap: 12px; }
        .stat-icon { width: 45px; height: 45px; background: rgba(255, 255, 255, 0.25); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: white; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
        .stat-text { text-align: left; }
        .stat-number { font-size: 22px; font-weight: 800; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); }
        .stat-label { font-size: 14px; color: white; opacity: 0.9; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .back-home { position: absolute; top: 20px; left: 20px; color: white; text-decoration: none; display: flex; align-items: center; gap: 8px; font-size: 14px; opacity: 0.9; }
        .back-home:hover { opacity: 1; }
        
        /* Right side - form */
        .register-form { padding: 40px; }
        .form-header { text-align: center; margin-bottom: 30px; }
        .form-header h1 { font-size: 28px; font-weight: 700; color: #1a1a1a; margin: 0 0 8px; }
        .form-header p { color: #666; margin: 0; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-grid .full { grid-column: 1 / -1; }
        .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; }
        .field label { font-weight: 600; font-size: 14px; color: #333; }
        .field input, .field select { padding: 14px 16px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 14px; transition: all 0.3s ease; }
        .field input:focus, .field select:focus { outline: none; border-color: #212346; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .field .help { font-size: 12px; color: #666; margin-top: 4px; margin-left: 8px; }
        .field .error { font-size: 12px; color: #dc3545; margin-top: 4px; }
        
        .password-requirements { background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 16px; margin-top: 8px; }
        .password-requirements h4 { font-size: 14px; margin: 0 0 8px; color: #495057; font-weight: 600; }
        .password-requirements ul { margin: 0; padding-left: 16px; font-size: 13px; color: #6c757d; }
        .password-requirements li { margin: 4px 0; }
        
        .submit-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #212346 0%, #CE3A81 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 8px; }
        .submit-btn:hover { transform: translateY(-2px); }
        .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .divider { display: flex; align-items: center; margin: 20px 0; text-align: center; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: #e0e0e0; }
        .divider span { padding: 0 16px; color: #666; font-size: 14px; background: #f8f9fa; }
        
        .social-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .social-btn { padding: 16px; background: white; color: #333; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .social-btn:hover { background: #f8f9fa; border-color: #212346; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .social-btn i { font-size: 16px; }
        .google-btn i { color: #4285f4; }
        .github-btn i { color: #333; }
        
        .form-footer { text-align: center; margin-top: 24px; padding-top: 20px; border-top: 1px solid #eee; }
        .form-footer a { color: #212346; text-decoration: none; font-weight: 500; }
        .form-footer a:hover { text-decoration: underline; }
        
        @media (max-width: 768px) { 
            .register-container { grid-template-columns: 1fr; max-width: 480px; }
            .register-brand { padding: 30px 20px; }
            .register-form { padding: 30px 20px; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <th:block th:replace="fragments/background :: background-elements"></th:block>
    
    <div class="register-wrapper">
        <div class="register-container">
            <!-- Left Side - Branding -->
            <div class="register-brand">
                <a href="/" class="back-home">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </a>
                
                <div class="brand-content">
                    <div class="brand-logo">
                        <h2>Nexio</h2>
                        <p class="brand-subtitle">Student Marketplace</p>
                    </div>
                    
                    <div class="brand-features">
                        <div class="brand-feature">
                            <i class="fas fa-shield-alt"></i>
                            <span>Verified student community</span>
                        </div>
                        <div class="brand-feature">
                            <i class="fas fa-users"></i>
                            <span>Connect with peers</span>
                        </div>
                        <div class="brand-feature">
                            <i class="fas fa-heart"></i>
                            <span>Safe & trusted platform</span>
                        </div>
                        <div class="brand-feature">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Made by students, for students</span>
                        </div>
                    </div>
                    
                    <div class="brand-stats">
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-text">
                                <div class="stat-number">500+</div>
                                <div class="stat-label">Active Students</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-text">
                                <div class="stat-number">1000+</div>
                                <div class="stat-label">Items Listed</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="stat-text">
                                <div class="stat-number">6</div>
                                <div class="stat-label">Universities</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Side - Registration Form -->
            <div class="register-form">
                <div class="form-header">
                    <h1>Create Account</h1>
                    <p>Join the student marketplace community</p>
                </div>
                
                <form th:action="@{/auth/register}" th:method="post" th:object="${registerRequest}">
                    <div class="form-grid">
                        <div class="field">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" name="firstName" th:field="*{firstName}" required>
                            <p class="alert-warning" th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}"></p>

                        </div>
                        
                        <div class="field">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" name="lastName" th:field="*{lastName}" required>
                            <p class="alert-warning" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}"></p>

                        </div>
                        
                        <div class="field full">
                            <label for="username">Username *</label>
                            <input type="text" id="username" name="username" placeholder="Choose a unique username" th:field="*{username}" required>
                            <p class="alert-warning" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></p>
                        </div>
                        
                        <div class="field full">
                            <label for="email">University Email *</label>
                            <input type="email" id="email" name="email" placeholder="your.email@university.edu" th:field="*{email}" required>
                            <p class="alert-warning" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></p>

                        </div>
                        
                        <div class="field full">
                            <label for="university">University *</label>
                            <select id="university" name="university" th:field="*{university}" required>
                                <option th:each="university : ${T(com.app.nexio.user.model.University).values()}"
                                        th:value="${university}"
                                        th:text="${university.getDisplayName()}" >
                                </option>
                            </select>
                        </div>
                        
                        <div class="field full">
                            <label for="password">Password *</label>
                            <input type="password" id="password" name="password" th:field="*{password}" required>
                            <p class="alert-warning" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></p>
                            <div class="password-requirements">
                                <h4>Password must contain:</h4>
                                <ul>
                                    <li>At least 8 characters</li>
                                    <li>At least 1 uppercase letter</li>
                                    <li>At least 1 number</li>
                                    <li>At least 1 special character (!@#$%^&*)</li>
                                </ul>
                            </div>
                        </div>
                        
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitBtn">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                    
                    <div class="divider">
                        <span>or</span>
                    </div>
                    
                    <div class="social-buttons">
                        <button type="button" class="social-btn google-btn" id="googleSignUpBtn">
                            <i class="fab fa-google"></i>
                            Google
                        </button>
                        <button type="button" class="social-btn github-btn" id="githubSignUpBtn">
                            <i class="fab fa-github"></i>
                            GitHub
                        </button>
                    </div>
                    
                    <div class="form-footer">
                        <p>Already have an account? <a href="/auth/login">Sign in here</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Password validation
        document.addEventListener('DOMContentLoaded', function() {
            const password = document.getElementById('password');
            const submitBtn = document.getElementById('submitBtn');
            
            // Real-time password strength indicator
            password.addEventListener('input', function() {
                const value = this.value;
                const requirements = document.querySelectorAll('.password-requirements li');
                
                // Check each requirement
                const hasLength = value.length >= 8;
                const hasUpper = /[A-Z]/.test(value);
                const hasNumber = /[0-9]/.test(value);
                const hasSpecial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>/?]/.test(value);
                
                requirements[0].style.color = hasLength ? '#28a745' : '#6c757d';
                requirements[1].style.color = hasUpper ? '#28a745' : '#6c757d';
                requirements[2].style.color = hasNumber ? '#28a745' : '#6c757d';
                requirements[3].style.color = hasSpecial ? '#28a745' : '#6c757d';
                
                // Update border color
                if (hasLength && hasUpper && hasNumber && hasSpecial) {
                    this.style.borderColor = '#28a745';
                } else if (value.length > 0) {
                    this.style.borderColor = '#ffc107';
                } else {
                    this.style.borderColor = '#e0e0e0';
                }
            });
            
            // Email validation for university domains
            const email = document.getElementById('email');
            email.addEventListener('blur', function() {
                const value = this.value.toLowerCase();
                const validDomains = [
                    'nbu.bg', 'mu-sofia.bg', 'uni-sofia.bg', 'tu-sofia.bg', 
                    'unwe.bg', 'uacg.bg', 'student.nbu.bg'
                ];
            });
            
            // Form submission handling
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
                submitBtn.disabled = true;
            });
            
            // Social Sign-In handling
            const googleBtn = document.getElementById('googleSignUpBtn');
            const githubBtn = document.getElementById('githubSignUpBtn');
            
            googleBtn.addEventListener('click', function() {
                // For now, this is a placeholder. In a real implementation, you would:
                // 1. Initialize Google Sign-In API
                // 2. Handle the OAuth flow
                // 3. Send the Google token to your backend
                // 4. Create user account with Google profile data
                
                alert('Google Sign-In integration coming soon! For now, please use the regular registration form.');
                
                // Example of what the implementation might look like:
                /*
                gapi.load('auth2', function() {
                    gapi.auth2.init({
                        client_id: 'YOUR_GOOGLE_CLIENT_ID'
                    }).then(function() {
                        const authInstance = gapi.auth2.getAuthInstance();
                        authInstance.signIn().then(function(googleUser) {
                            const profile = googleUser.getBasicProfile();
                            const idToken = googleUser.getAuthResponse().id_token;
                            
                            // Send to your backend
                            fetch('/auth/google-register', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    idToken: idToken,
                                    email: profile.getEmail(),
                                    firstName: profile.getGivenName(),
                                    lastName: profile.getFamilyName()
                                })
                            }).then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    window.location.href = '/users/profile';
                                } else {
                                    alert('Registration failed: ' + data.message);
                                }
                            });
                        });
                    });
                });
                */
            });
            
            githubBtn.addEventListener('click', function() {
                // For now, this is a placeholder. In a real implementation, you would:
                // 1. Redirect to GitHub OAuth
                // 2. Handle the OAuth callback
                // 3. Send the GitHub token to your backend
                // 4. Create user account with GitHub profile data
                
                alert('GitHub Sign-In integration coming soon! For now, please use the regular registration form.');
                
                // Example of what the implementation might look like:
                /*
                // Redirect to GitHub OAuth
                const clientId = 'YOUR_GITHUB_CLIENT_ID';
                const redirectUri = encodeURIComponent(window.location.origin + '/auth/github/callback');
                const scope = 'user:email';
                const githubAuthUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}`;
                window.location.href = githubAuthUrl;
                */
            });
        });
    </script>
    
    <!-- Enhanced client-side validation -->
    <script>
        // Enhanced client-side validation for registration form
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const inputs = form.querySelectorAll('input[required]');
            
            // Real-time validation for each input
            inputs.forEach(input => {
                // Validate on blur (when user leaves the field)
                input.addEventListener('blur', function() {
                    validateField(this);
                });
                
                // Clear errors on input (when user starts typing)
                input.addEventListener('input', function() {
                    clearFieldError(this);
                });
            });
            
            // Enhanced form submission validation
            form.addEventListener('submit', function(e) {
                let isValid = true;
                
                inputs.forEach(input => {
                    if (!validateField(input)) {
                        isValid = false;
                    }
                });
                
                if (!isValid) {
                    e.preventDefault();
                    showFormError('Please fix the errors above before submitting.');
                }
            });
            
            function validateField(field) {
                const value = field.value.trim();
                const fieldName = field.name;
                let isValid = true;
                let errorMessage = '';
                
                // Clear previous errors
                clearFieldError(field);
                
                // Required field validation
                if (!value) {
                    errorMessage = getRequiredMessage(fieldName);
                    isValid = false;
                } else {
                    // Field-specific validation
                    switch (fieldName) {
                        case 'firstName':
                        case 'lastName':
                            if (value.length > 50) {
                                errorMessage = 'Name cannot exceed 50 characters';
                                isValid = false;
                            }
                            break;
                            
                        case 'username':
                            if (value.length < 3 || value.length > 20) {
                                errorMessage = 'Username must be between 3 and 20 characters';
                                isValid = false;
                            } else if (!/^[a-zA-Z0-9_]+$/.test(value)) {
                                errorMessage = 'Username can only contain letters, numbers, and underscores';
                                isValid = false;
                            }
                            break;
                            
                        case 'email':
                            if (!isValidEmail(value)) {
                                errorMessage = 'Please enter a valid email address';
                                isValid = false;
                            }
                            break;
                            
                        case 'password':
                            if (!isValidPassword(value)) {
                                errorMessage = 'Please create a password that meets the requirements';
                                isValid = false;
                            }
                            break;
                    }
                }
                
                if (!isValid) {
                    showFieldError(field, errorMessage);
                }
                
                return isValid;
            }
            
            function showFieldError(field, message) {
                // Create or update error message (no red border on input)
                let errorElement = field.parentNode.querySelector('.field-error');
                if (!errorElement) {
                    errorElement = document.createElement('div');
                    errorElement.className = 'field-error alert-warning';
                    field.parentNode.appendChild(errorElement);
                }
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
            
            function clearFieldError(field) {
                const errorElement = field.parentNode.querySelector('.field-error');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }
            
            function showFormError(message) {
                // Remove existing form error
                const existingError = document.querySelector('.form-error');
                if (existingError) {
                    existingError.remove();
                }
                
                // Create new form error
                const errorElement = document.createElement('div');
                errorElement.className = 'form-error alert-warning';
                errorElement.textContent = message;
                errorElement.style.marginBottom = '20px';
                
                // Insert at the top of the form
                form.insertBefore(errorElement, form.firstChild);
                
                // Scroll to top of form
                form.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            function getRequiredMessage(fieldName) {
                const messages = {
                    'firstName': 'Please enter your first name',
                    'lastName': 'Please enter your last name',
                    'username': 'Please choose a username',
                    'email': 'Please enter your email address',
                    'password': 'Please create a password'
                };
                return messages[fieldName] || 'This field is required';
            }
            
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }
            
            function isValidPassword(password) {
                // At least 8 characters, 1 uppercase, 1 digit, 1 special character
                const passwordRegex = /^(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>/?])(?=.*[a-zA-Z]).{8,}$/;
                return passwordRegex.test(password);
            }
        });
    </script>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>
</body>
</html>
