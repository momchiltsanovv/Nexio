<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wishlist - Nexio</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/wishlist.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <th:block th:replace="~{fragments/background :: background-styles}"></th:block>
</head>
<body>
<th:block th:replace="~{fragments/background :: background-elements}"></th:block>

<div class="page-wrapper">
    <div th:replace="~{fragments/navbar :: navbar(${active})}"></div>

    <div class="page-content">
        <div class="wishlist-wrapper">
            <!-- Header -->
            <div class="wishlist-header">
                <div class="wishlist-title">
                    <h1 class="section-title">
                        My Wishlist
                    </h1>
                    <span class="wishlist-count" id="wishlistCount"
                          th:text="${wishlistItems.size() + ' items'}">3 items</span>
                </div>
                <div class="wishlist-actions">
                    <form th:action="@{/wishlist/clear}" th:method="post">
                        <input type="hidden" name="_method" value="delete"/>
                        <button class="btn btn-secondary" id="clearWishlist">
                            <i class="fas fa-trash"></i>
                            Clear All
                        </button>
                    </form>
                </div>
            </div>


            <!-- Wishlist Items -->
            <div class="wishlist-grid" id="wishlistGrid">
                <div class="item-card"
                     th:each="item : ${wishlistItems}"
                     th:data-item-id="${item.id}"
                     th:data-category="${item.category != null ? item.category : ''}"
                     th:data-condition="${item.condition != null ? item.condition : ''}"
                     th:data-price="${item.price}"
                     th:data-location="${item.exchangeLocation.name()}"
                     th:data-description="${item.description}"
                     th:data-id="${item.id}"
                     th:data-title="${item.name}"
                     th:data-imageurl="${item.imageURLs != null and !item.imageURLs.isEmpty() ? item.imageURLs[0] : '/images/defaults/no_image.webp'}"
                     th:data-seller-name="${item.owner.firstName + ' ' + item.owner.lastName}"
                     th:data-seller-uni="${item.owner.university}"
                     th:data-seller-avatar="${item.owner.profilePictureURL != null ? item.owner.profilePictureURL : '/images/defaults/default_pfp.jpg'}"
                     th:data-createdat="${item.createdOn}">
                    <div class="item-image">
                        <img th:src="@{${item.imageURLs != null and !item.imageURLs.isEmpty() ? item.imageURLs[0] : '/images/defaults/no_image.webp'}}"
                             th:alt="${item.name ?: 'Item image'}" onerror="this.src='/images/defaults/no_image.webp'">
                        <div class="item-badges">
                            <span class="condition-badge"
                                  th:classappend="${item.condition != null ? #strings.toLowerCase(item.condition.getDisplayName()).replace(' ', '-') : ''}"
                                  th:text="${item.condition.getDisplayName()}">Good</span>
                        </div>

                        <form th:action="@{'/wishlist/' + ${item.id} + '/remove?redirect=/wishlist'}" th:method="post">
                            <input type="hidden" name="_method" value="delete"/>
                            <button class="remove-btn" th:data-item-id="${item.id}">
                                <i class="fas fa-times"></i>
                            </button>
                        </form>

                    </div>
                    <div class="item-content">
                        <div class="item-category" th:if="${item.category != null}">
                            <span th:text="${item.category}">Category</span>
                        </div>
                        <h3 class="item-title" th:text="${item.name ?: 'Untitled Item'}">Item Title</h3>
                        <p class="item-description" th:text="${item.description ?: 'No description available'}">Item
                            description</p>
                        <div class="item-details">
                            <div class="item-price"
                                 th:text="${item.price != null ? item.price + ' лв' : 'Price not set'}">0 лв
                            </div>
                            <div class="item-location" th:if="${item.exchangeLocation != null}">
                                <i class="fas fa-map-marker-alt"></i>
                                <span th:text="${item.exchangeLocation != null ? item.exchangeLocation.displayName : 'Location not set'}">Location</span>
                            </div>
                        </div>
                        <div class="item-actions">
                            <a th:href="@{'/items/' + ${item.id}}" class="btn btn-primary">
                                <i class="fas fa-eye"></i>
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty State (hidden by default) -->
            <div class="empty-state" id="emptyState"
                 th:style="${wishlistItems.isEmpty() ? 'display: block;' : 'display: none;'}">
                <div class="empty-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3 class="empty-title">Your wishlist is empty</h3>
                <p class="empty-text">Start browsing items and add them to your wishlist to see them here.</p>
                <a href="/home" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                    Browse Items
                </a>
            </div>
        </div>
    </div>

    <script th:replace="~{fragments/navbar-script :: navbar-script}"></script>
    <script th:src="@{/js/wishlist.js}"></script>
    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>
