<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - Nexio</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <th:block th:replace="fragments/background :: background-styles"></th:block>
    <link rel="stylesheet" th:href="@{/css/edit-profile.css}">
</head>
<body>
<th:block th:replace="fragments/background :: background-elements"></th:block>

<div th:replace="fragments/navbar :: navbar(${active})"></div>

<div class="edit-wrapper">
    <div class="edit-card">
        <div class="edit-header">
            <i class="fas fa-user-edit" style="color: #212346;"></i>
            <h1>Edit Profile Details</h1>
        </div>

        <form th:action="@{/users/profile/details}" th:method="patch" th:object="${user}">
            <div class="edit-body">
                <div class="field full">
                    <label>Profile Picture</label>
                    <div class="avatar-section">
                        <img class="current-avatar" id="avatarPreview"
                             th:src="${user != null and user.profilePictureURL != null} ? ${user.profilePictureURL} : 'https://via.placeholder.com/80x80/667eea/ffffff?text=U'"
                             alt="Current avatar">
                        <div class="avatar-upload">
                            <div class="file-upload-container">
                                <input type="file" id="profilePictureFile" name="profilePictureFile"
                                       accept="image/*" style="display: none;">
                                <button type="button" class="file-upload-btn"
                                        onclick="document.getElementById('profilePictureFile').click()">
                                    <i class="fas fa-camera"></i>
                                    Choose Photo
                                </button>
                                <input type="hidden" id="profilePictureURL" th:field="*{profilePictureURL}">
                            </div>
                            <div class="help-text">Upload a photo from your device (JPG, PNG, GIF up to 5MB)</div>
                            <div class="file-info" id="fileInfo" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div class="form-grid">

                    <div class="field">
                        <label for="firstName">First Name</label>
                        <div class="input-with-clear">
                            <input type="text" id="firstName" th:field="*{firstName}"
                                   placeholder="Jane" required>
                            <button type="button" class="clear-btn" onclick="clearField('firstName')"
                                    th:if="${user.firstName != null and user.firstName != ''}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="field">
                        <label for="lastName">lastName </label>
                        <div class="input-with-clear">
                            <input type="text" id="lastName" th:field="*{lastName}"
                                   placeholder="Doe" required>
                            <button type="button" class="clear-btn" onclick="clearField('lastName')"
                                    th:if="${user.lastName != null and user.lastName != ''}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="field">
                        <label for="major">Major</label>
                        <div class="input-with-clear">
                            <input type="text" id="major" th:field="*{major}"
                                   placeholder="e.g., Computer Science">
                            <button type="button" class="clear-btn" onclick="clearField('major')"
                                    th:if="${user.major != null and user.major != ''}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="field">
                        <label for="university">University</label>
                        <select id="university" th:field="*{university}" required>
                            <option value="">Select University</option>
                            <option th:each="university : ${T(com.app.nexio.user.model.University).values()}"
                                    th:value="${university}"
                                    th:text="${university.displayName}"
                                    th:selected="${user.university != null and user.university.name() == university.name()}">
                            </option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="graduationYear">Graduation Year</label>
                        <div class="input-with-clear">
                            <input type="number" id="graduationYear" th:field="*{graduationYear}"
                                   min="2024" max="2030" placeholder="2026">
                            <button type="button" class="clear-btn" onclick="clearField('graduationYear')"
                                    th:if="${user.graduationYear != null}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="field">
                        <label for="instagramURL">Instagram URL</label>
                        <div class="input-with-clear">
                            <input type="url" id="instagramURL" th:field="*{instagramURL}"
                                   placeholder="https://instagram.com/username">
                            <button type="button" class="clear-btn" onclick="clearField('instagramURL')"
                                    th:if="${user.instagramURL != null and user.instagramURL != ''}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div class="field">
                        <label for="linkedinURL">LinkedIn URL</label>
                        <div class="input-with-clear">
                            <input type="url" id="linkedinURL" th:field="*{linkedinURL}"
                                   placeholder="https://linkedin.com/in/username">
                            <button type="button" class="clear-btn" onclick="clearField('linkedinURL')"
                                    th:if="${user.linkedinURL != null and user.linkedinURL != ''}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="/users/profile" class="btn btn-secondary">
                        <i class="fas fa-times"></i>
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script th:src="@{/js/edit-profile.js}"></script>

<div th:replace="fragments/navbar-script :: navbar-script"></div>
</body>
</html>
